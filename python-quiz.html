<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Assessment Quiz - ReKnew Training</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .code-input { font-family: 'Courier New', monospace; }
        pre { background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Initialize EmailJS (You need to replace with your actual credentials)
        // Sign up at https://www.emailjs.com/ and get your public key
        emailjs.init("sJzYX6welA8F5Mrqm"); // REPLACE THIS

        const QUIZ_DATA = {
            mcqs: [
                {
                    id: 1,
                    question: "Which of the following variable names is INVALID in Python?",
                    options: [
                        { text: "my_number", correct: false },
                        { text: "_value", correct: false },
                        { text: "2nd_variable", correct: true },
                        { text: "userName", correct: false }
                    ],
                    explanation: "Variable names in Python cannot start with a digit. They must start with a letter or underscore. '2nd_variable' is invalid because it starts with a number."
                },
                {
                    id: 2,
                    question: "What will be the output of the following code?\n\nx = 5\ny = 10\nprint(x > 3 and y < 15)",
                    options: [
                        { text: "True", correct: true },
                        { text: "False", correct: false },
                        { text: "Error", correct: false },
                        { text: "None", correct: false }
                    ],
                    explanation: "The logical 'and' operator returns True when both conditions are true. x > 3 (5 > 3 = True) and y < 15 (10 < 15 = True), so True and True = True."
                },
                {
                    id: 3,
                    question: "What does the split() method do in Python strings?",
                    options: [
                        { text: "Splits a string into a list of words based on a delimiter", correct: true },
                        { text: "Removes whitespace from a string", correct: false },
                        { text: "Converts the string to uppercase", correct: false },
                        { text: "Counts the number of characters in a string", correct: false }
                    ],
                    explanation: "The split() method divides a string into a list of substrings based on a delimiter (default is whitespace). Example: 'hello world'.split() returns ['hello', 'world']."
                },
                {
                    id: 4,
                    question: "What is the key difference between a list and a tuple in Python?",
                    options: [
                        { text: "Lists are faster than tuples", correct: false },
                        { text: "Lists are mutable, tuples are immutable", correct: true },
                        { text: "Tuples can store only numbers", correct: false },
                        { text: "Lists cannot store strings", correct: false }
                    ],
                    explanation: "Lists can be modified after creation (mutable), while tuples cannot be modified after creation (immutable). Both can store any data type."
                },
                {
                    id: 5,
                    question: "What will be the output of the following code?\n\nattendance = 70\nscore = 45\n\nif attendance > 65:\n    if score > 50:\n        print('Promoted')\n    else:\n        print('Not Promoted')\nelse:\n    print('Not Eligible')",
                    options: [
                        { text: "Promoted", correct: false },
                        { text: "Not Promoted", correct: true },
                        { text: "Not Eligible", correct: false },
                        { text: "Error", correct: false }
                    ],
                    explanation: "First condition (attendance > 65) is True, so we enter the outer if block. Second condition (score > 50) is False (45 < 50), so the else block executes: 'Not Promoted'."
                },
                {
                    id: 6,
                    question: "What is the output of the following function?\n\ndef calculate(a, b):\n    return a + b\n\nresult = calculate(5, 10)\nprint(result)",
                    options: [
                        { text: "15", correct: true },
                        { text: "510", correct: false },
                        { text: "None", correct: false },
                        { text: "Error", correct: false }
                    ],
                    explanation: "The function returns 5 + 10 = 15, which is stored in 'result' and then printed. The return statement sends the value back to the caller."
                },
                {
                    id: 7,
                    question: "A child class is created from two parent classes. This is an example of:",
                    options: [
                        { text: "Single Inheritance", correct: false },
                        { text: "Multiple Inheritance", correct: true },
                        { text: "Multi-level Inheritance", correct: false },
                        { text: "Hierarchical Inheritance", correct: false }
                    ],
                    explanation: "When a child class inherits from two or more parent classes, it's called Multiple Inheritance. Single is from one parent, Multi-level is sequential (A→B→C), and Hierarchical is multiple children from one parent."
                },
                {
                    id: 11,
                    question: "What will be the output of the following code?\n\nmy_dict = {'a': 1, 'b': 2, 'c': 3}\nprint(my_dict.get('d', 0))",
                    options: [
                        { text: "None", correct: false },
                        { text: "0", correct: true },
                        { text: "Error", correct: false },
                        { text: "'d'", correct: false }
                    ],
                    explanation: "The get() method returns the value for the specified key if it exists. If the key doesn't exist, it returns the default value (second parameter). Since 'd' is not in the dictionary, it returns 0."
                },
                {
                    id: 12,
                    question: "Which of the following is NOT a valid way to create an empty set in Python?",
                    options: [
                        { text: "set()", correct: false },
                        { text: "{}", correct: true },
                        { text: "set([])", correct: false },
                        { text: "set(())", correct: false }
                    ],
                    explanation: "{} creates an empty dictionary, not a set. To create an empty set, you must use set() or convert an iterable using set([]) or set(())."
                },
                {
                    id: 13,
                    question: "What is the output of this list comprehension?\n\nnumbers = [1, 2, 3, 4, 5]\nresult = [x**2 for x in numbers if x % 2 == 0]\nprint(result)",
                    options: [
                        { text: "[1, 4, 9, 16, 25]", correct: false },
                        { text: "[4, 16]", correct: true },
                        { text: "[2, 4]", correct: false },
                        { text: "[1, 9, 25]", correct: false }
                    ],
                    explanation: "The list comprehension filters even numbers (2, 4) and squares them. 2² = 4 and 4² = 16, resulting in [4, 16]."
                },
                {
                    id: 14,
                    question: "What does the 'break' statement do in a loop?",
                    options: [
                        { text: "Skips the current iteration and continues with the next", correct: false },
                        { text: "Exits the loop completely", correct: true },
                        { text: "Restarts the loop from the beginning", correct: false },
                        { text: "Pauses the loop temporarily", correct: false }
                    ],
                    explanation: "The 'break' statement immediately terminates the loop and continues execution after the loop. 'continue' skips the current iteration, while 'break' exits the loop entirely."
                },
                {
                    id: 15,
                    question: "Which keyword is used to handle exceptions in Python?",
                    options: [
                        { text: "catch", correct: false },
                        { text: "except", correct: true },
                        { text: "handle", correct: false },
                        { text: "error", correct: false }
                    ],
                    explanation: "Python uses 'try-except' blocks to handle exceptions. The 'except' keyword catches and handles errors that occur in the try block. Other languages like Java use 'catch'."
                },
                {
                    id: 16,
                    question: "What is the result of the following lambda function?\n\nmultiply = lambda x, y: x * y\nresult = multiply(3, 4)\nprint(result)",
                    options: [
                        { text: "7", correct: false },
                        { text: "12", correct: true },
                        { text: "34", correct: false },
                        { text: "Error", correct: false }
                    ],
                    explanation: "Lambda functions are anonymous functions. This lambda takes two parameters and multiplies them. multiply(3, 4) returns 3 * 4 = 12."
                },
                {
                    id: 17,
                    question: "What method is used to add an element to the end of a list?",
                    options: [
                        { text: "add()", correct: false },
                        { text: "append()", correct: true },
                        { text: "insert()", correct: false },
                        { text: "push()", correct: false }
                    ],
                    explanation: "The append() method adds an element to the end of a list. insert() adds at a specific position, extend() adds multiple elements, and push() is used in other languages, not Python."
                },
                {
                    id: 21,
                    question: "What will be the output of the following code?\n\nx = 5\nif x > 3 and x < 10:\n    print('Pass')\nelse:\n    print('Fail')",
                    options: [
                        { text: "Pass", correct: true },
                        { text: "Fail", correct: false },
                        { text: "Error", correct: false },
                        { text: "None", correct: false }
                    ],
                    explanation: "The 'and' operator returns True when both conditions are true. x > 3 (5 > 3 = True) and x < 10 (5 < 10 = True), so True and True = True, which executes the if block printing 'Pass'."
                },
                {
                    id: 22,
                    question: "Which statement is used to skip the current iteration of a loop and move to the next one?",
                    options: [
                        { text: "break", correct: false },
                        { text: "continue", correct: true },
                        { text: "pass", correct: false },
                        { text: "skip", correct: false }
                    ],
                    explanation: "The 'continue' statement skips the rest of the current iteration and moves to the next iteration. 'break' exits the loop entirely, and 'pass' does nothing (placeholder)."
                },
                {
                    id: 23,
                    question: "What is the output of the following string operation?\n\ntext = 'Python'\nprint(text[1:4])",
                    options: [
                        { text: "Pyt", correct: false },
                        { text: "yth", correct: true },
                        { text: "ytho", correct: false },
                        { text: "Pyth", correct: false }
                    ],
                    explanation: "String slicing text[1:4] returns characters from index 1 up to (but not including) index 4. Index 1='y', 2='t', 3='h', resulting in 'yth'."
                },
                {
                    id: 24,
                    question: "Which method removes and returns the last element from a list?",
                    options: [
                        { text: "remove()", correct: false },
                        { text: "delete()", correct: false },
                        { text: "pop()", correct: true },
                        { text: "clear()", correct: false }
                    ],
                    explanation: "The pop() method removes and returns the last element from a list. remove() deletes a specific value, clear() removes all elements, and delete() doesn't exist."
                },
                {
                    id: 25,
                    question: "What is the difference between a tuple and a list?",
                    options: [
                        { text: "Tuples use parentheses (), lists use square brackets []", correct: false },
                        { text: "Tuples are immutable, lists are mutable", correct: false },
                        { text: "Both A and B", correct: true },
                        { text: "There is no difference", correct: false }
                    ],
                    explanation: "Both statements are correct: Tuples use () and are immutable (cannot be changed after creation), while lists use [] and are mutable (can be modified)."
                },
                {
                    id: 26,
                    question: "How do you access the value associated with key 'name' in a dictionary?\n\nstudent = {'name': 'John', 'age': 20}",
                    options: [
                        { text: "student['name']", correct: true },
                        { text: "student('name')", correct: false },
                        { text: "student.name", correct: false },
                        { text: "student->name", correct: false }
                    ],
                    explanation: "Dictionary values are accessed using square bracket notation with the key: dict_name[key]. student['name'] returns 'John'."
                },
                {
                    id: 27,
                    question: "What does the range(1, 10, 2) function produce?",
                    options: [
                        { text: "Numbers from 1 to 10 in steps of 2", correct: false },
                        { text: "Numbers: 1, 3, 5, 7, 9", correct: true },
                        { text: "Numbers: 2, 4, 6, 8, 10", correct: false },
                        { text: "Error", correct: false }
                    ],
                    explanation: "range(start, stop, step) generates numbers from 1 (inclusive) to 10 (exclusive) in steps of 2, producing: 1, 3, 5, 7, 9."
                },
                {
                    id: 28,
                    question: "What will this code print?\n\nfor i in range(3):\n    if i == 1:\n        break\n    print(i)",
                    options: [
                        { text: "0", correct: true },
                        { text: "0 1", correct: false },
                        { text: "0 1 2", correct: false },
                        { text: "1 2", correct: false }
                    ],
                    explanation: "The loop starts with i=0 (prints 0), then i=1 triggers the break statement which exits the loop immediately. Only 0 is printed."
                },
                {
                    id: 29,
                    question: "Which string method converts all characters to uppercase?",
                    options: [
                        { text: "upper()", correct: true },
                        { text: "uppercase()", correct: false },
                        { text: "toUpper()", correct: false },
                        { text: "capitalize()", correct: false }
                    ],
                    explanation: "The upper() method converts all characters in a string to uppercase. capitalize() only capitalizes the first character."
                },
                {
                    id: 30,
                    question: "What is the output of len([1, 2, 3, 4, 5])?",
                    options: [
                        { text: "4", correct: false },
                        { text: "5", correct: true },
                        { text: "15", correct: false },
                        { text: "Error", correct: false }
                    ],
                    explanation: "The len() function returns the number of elements in a list. This list has 5 elements, so it returns 5."
                },
                {
                    id: 31,
                    question: "What keyword is used to define a function in Python?",
                    options: [
                        { text: "function", correct: false },
                        { text: "def", correct: true },
                        { text: "func", correct: false },
                        { text: "define", correct: false }
                    ],
                    explanation: "Python uses the 'def' keyword to define functions, followed by the function name and parameters: def function_name(parameters):"
                },
                {
                    id: 32,
                    question: "What does this list comprehension produce?\n\n[x*2 for x in range(5)]",
                    options: [
                        { text: "[0, 1, 2, 3, 4]", correct: false },
                        { text: "[0, 2, 4, 6, 8]", correct: true },
                        { text: "[2, 4, 6, 8, 10]", correct: false },
                        { text: "[1, 2, 3, 4, 5]", correct: false }
                    ],
                    explanation: "List comprehension [x*2 for x in range(5)] multiplies each number from 0-4 by 2, producing [0, 2, 4, 6, 8]."
                },
                {
                    id: 33,
                    question: "What is the output of this code?\n\ndef greet(name='Guest'):\n    return f'Hello {name}'\n\nprint(greet())",
                    options: [
                        { text: "Hello", correct: false },
                        { text: "Hello Guest", correct: true },
                        { text: "Hello name", correct: false },
                        { text: "Error", correct: false }
                    ],
                    explanation: "The function has a default parameter value 'Guest'. When called without arguments, it uses the default, printing 'Hello Guest'."
                },
                {
                    id: 34,
                    question: "Which operator is used to check if a value exists in a list?",
                    options: [
                        { text: "exists", correct: false },
                        { text: "in", correct: true },
                        { text: "contains", correct: false },
                        { text: "has", correct: false }
                    ],
                    explanation: "The 'in' operator checks for membership in sequences. Example: 5 in [1, 2, 3, 4, 5] returns True."
                }
            ],
            coding: [
                {
                    id: 8,
                    question: "Write a program to print all even numbers between 1 and 20 (inclusive)",
                    description: "Use a for loop with range() and an if statement to check if a number is even. Print each even number on a new line.",
                    expectedOutput: "2\n4\n6\n8\n10\n12\n14\n16\n18\n20",
                    sampleSolution: `for i in range(1, 21):
    if i % 2 == 0:
        print(i)`,
                    testCases: [
                        { description: "Prints all even numbers from 2 to 20", points: 10 }
                    ]
                },
                {
                    id: 9,
                    question: "Create a function that calculates the area of a rectangle",
                    description: "Write a Python function named 'calculate_area' that takes two parameters (length and width) and returns the area. Then call the function with length=5 and width=3, and print the result.",
                    expectedOutput: "15",
                    sampleSolution: `def calculate_area(length, width):
    return length * width

result = calculate_area(5, 3)
print(result)`,
                    testCases: [
                        { description: "Function correctly calculates and returns area", points: 10 }
                    ]
                },
                {
                    id: 10,
                    question: "Dictionary and List Manipulation",
                    description: "Given the dictionary below, write a program that finds the student with the highest marks and prints the result in the format: '[Name] scored [Marks] marks'\n\nstudents = {\n    'Alice': 85,\n    'Bob': 92,\n    'Charlie': 78,\n    'Diana': 95\n}",
                    expectedOutput: "Diana scored 95 marks",
                    sampleSolution: `students = {
    "Alice": 85,
    "Bob": 92,
    "Charlie": 78,
    "Diana": 95
}

max_marks = max(students.values())
for name, marks in students.items():
    if marks == max_marks:
        print(f"{name} scored {marks} marks")`,
                    testCases: [
                        { description: "Correctly identifies highest scoring student", points: 10 }
                    ]
                },
                {
                    id: 18,
                    question: "String Manipulation - Count Vowels",
                    description: "Write a program that counts the number of vowels (a, e, i, o, u) in a given string. The string is: 'Python Programming'\n\nPrint the result in the format: 'Number of vowels: X'",
                    expectedOutput: "Number of vowels: 4",
                    sampleSolution: `text = "Python Programming"
vowels = "aeiouAEIOU"
count = 0

for char in text:
    if char in vowels:
        count += 1

print(f"Number of vowels: {count}")`,
                    testCases: [
                        { description: "Correctly counts all vowels in the string", points: 10 }
                    ]
                },
                {
                    id: 19,
                    question: "FizzBuzz Problem",
                    description: "Write a program that prints numbers from 1 to 15. For multiples of 3, print 'Fizz' instead of the number. For multiples of 5, print 'Buzz'. For numbers that are multiples of both 3 and 5, print 'FizzBuzz'.",
                    expectedOutput: "1\n2\nFizz\n4\nBuzz\nFizz\n7\n8\nFizz\nBuzz\n11\nFizz\n13\n14\nFizzBuzz",
                    sampleSolution: `for i in range(1, 16):
    if i % 3 == 0 and i % 5 == 0:
        print("FizzBuzz")
    elif i % 3 == 0:
        print("Fizz")
    elif i % 5 == 0:
        print("Buzz")
    else:
        print(i)`,
                    testCases: [
                        { description: "Correctly implements FizzBuzz logic", points: 10 }
                    ]
                },
                {
                    id: 20,
                    question: "List Operations - Remove Duplicates",
                    description: "Given a list of numbers, write a program that removes all duplicate values and prints the unique numbers in ascending order.\n\nGiven list: [5, 2, 8, 2, 9, 5, 1, 8, 3]\n\nPrint each unique number on a new line.",
                    expectedOutput: "1\n2\n3\n5\n8\n9",
                    sampleSolution: `numbers = [5, 2, 8, 2, 9, 5, 1, 8, 3]

# Convert to set to remove duplicates, then sort
unique_numbers = sorted(set(numbers))

for num in unique_numbers:
    print(num)`,
                    testCases: [
                        { description: "Removes duplicates and sorts correctly", points: 10 }
                    ]
                },
                {
                    id: 35,
                    question: "Find Maximum in List",
                    description: "Write a program that finds and prints the maximum value from a given list without using the max() function.\n\nGiven list: [23, 67, 12, 89, 45, 34]\n\nPrint the result in the format: 'Maximum value: X'",
                    expectedOutput: "Maximum value: 89",
                    sampleSolution: `numbers = [23, 67, 12, 89, 45, 34]

max_value = numbers[0]
for num in numbers:
    if num > max_value:
        max_value = num

print(f"Maximum value: {max_value}")`,
                    testCases: [
                        { description: "Correctly finds maximum without using max()", points: 10 }
                    ]
                },
                {
                    id: 36,
                    question: "Reverse a String",
                    description: "Write a program that takes a string and prints it in reverse order.\n\nGiven string: 'Python Programming'\n\nPrint the reversed string.",
                    expectedOutput: "gnimmargorP nohtyP",
                    sampleSolution: `text = "Python Programming"

# Method 1: Using slicing
reversed_text = text[::-1]
print(reversed_text)

# Method 2: Using loop (alternative)
# reversed_text = ""
# for char in text:
#     reversed_text = char + reversed_text
# print(reversed_text)`,
                    testCases: [
                        { description: "Correctly reverses the string", points: 10 }
                    ]
                },
                {
                    id: 37,
                    question: "Dictionary Operations - Sum Values",
                    description: "Given a dictionary of product prices, write a program that calculates and prints the total price of all products.\n\nproducts = {\n    'Laptop': 45000,\n    'Mouse': 500,\n    'Keyboard': 1500,\n    'Monitor': 12000\n}\n\nPrint: 'Total price: X'",
                    expectedOutput: "Total price: 59000",
                    sampleSolution: `products = {
    'Laptop': 45000,
    'Mouse': 500,
    'Keyboard': 1500,
    'Monitor': 12000
}

total = sum(products.values())
print(f"Total price: {total}")

# Alternative method using loop:
# total = 0
# for price in products.values():
#     total += price
# print(f"Total price: {total}")`,
                    testCases: [
                        { description: "Correctly calculates sum of dictionary values", points: 10 }
                    ]
                },
                {
                    id: 38,
                    question: "Function - Factorial Calculator",
                    description: "Write a function called 'factorial' that takes a number as input and returns its factorial.\n\nThen call the function with the number 5 and print the result in the format: 'Factorial of 5 is X'\n\nNote: 5! = 5 × 4 × 3 × 2 × 1 = 120",
                    expectedOutput: "Factorial of 5 is 120",
                    sampleSolution: `def factorial(n):
    result = 1
    for i in range(1, n + 1):
        result *= i
    return result

number = 5
result = factorial(number)
print(f"Factorial of {number} is {result}")`,
                    testCases: [
                        { description: "Function correctly calculates factorial", points: 10 }
                    ]
                },
                {
                    id: 39,
                    question: "List Comprehension - Squares of Even Numbers",
                    description: "Write a program using list comprehension that creates a list of squares of all even numbers from 1 to 10.\n\nThen print the resulting list.",
                    expectedOutput: "[4, 16, 36, 64, 100]",
                    sampleSolution: `# Using list comprehension
squares = [x**2 for x in range(1, 11) if x % 2 == 0]
print(squares)

# Alternative method without list comprehension:
# squares = []
# for x in range(1, 11):
#     if x % 2 == 0:
#         squares.append(x**2)
# print(squares)`,
                    testCases: [
                        { description: "Creates correct list using comprehension", points: 10 }
                    ]
                },
                {
                    id: 40,
                    question: "Nested Loops - Multiplication Table",
                    description: "Write a program that prints a multiplication table for numbers 1 to 5.\n\nFormat each line as: 'X * Y = Z'\n\nPrint the complete multiplication table.",
                    expectedOutput: "1 * 1 = 1\n1 * 2 = 2\n1 * 3 = 3\n1 * 4 = 4\n1 * 5 = 5\n2 * 1 = 2\n2 * 2 = 4\n2 * 3 = 6\n2 * 4 = 8\n2 * 5 = 10\n3 * 1 = 3\n3 * 2 = 6\n3 * 3 = 9\n3 * 4 = 12\n3 * 5 = 15\n4 * 1 = 4\n4 * 2 = 8\n4 * 3 = 12\n4 * 4 = 16\n4 * 5 = 20\n5 * 1 = 5\n5 * 2 = 10\n5 * 3 = 15\n5 * 4 = 20\n5 * 5 = 25",
                    sampleSolution: `for i in range(1, 6):
    for j in range(1, 6):
        result = i * j
        print(f"{i} * {j} = {result}")`,
                    testCases: [
                        { description: "Correctly prints multiplication table using nested loops", points: 10 }
                    ]
                }
            ]
        };

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Function to randomly select N items from an array (like Python's random.sample)
        function randomSample(array, count) {
            const shuffled = shuffleArray([...array]);
            return shuffled.slice(0, count);
        }

        function QuizApp() {
            const [stage, setStage] = useState('welcome'); // welcome, quiz, results
            const [studentInfo, setStudentInfo] = useState({ firstName: '', lastName: '', email: '' });
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [answers, setAnswers] = useState({});
            const [startTime, setStartTime] = useState(null);
            const [endTime, setEndTime] = useState(null);
            const [questions, setQuestions] = useState([]);
            const [errorMessage, setErrorMessage] = useState('');

            useEffect(() => {
                // Select 14 random MCQs from 28 available
                const selectedMCQs = randomSample(QUIZ_DATA.mcqs, 14);
                
                // Select 6 random Coding questions from 12 available
                const selectedCoding = randomSample(QUIZ_DATA.coding, 6);
                
                // Combine to get 20 total questions
                const selectedQuestions = [...selectedMCQs, ...selectedCoding];
                
                // Shuffle the combined 20 questions
                const shuffled = shuffleArray(selectedQuestions);
                
                // Randomize MCQ options
                const randomized = shuffled.map(q => {
                    if (q.options) {
                        return { ...q, options: shuffleArray(q.options) };
                    }
                    return q;
                });
                
                setQuestions(randomized);
            }, []);

            const checkEmailExists = (email) => {
                const attempts = JSON.parse(localStorage.getItem('quizAttempts') || '[]');
                return attempts.includes(email.toLowerCase());
            };

            const recordAttempt = (email) => {
                const attempts = JSON.parse(localStorage.getItem('quizAttempts') || '[]');
                attempts.push(email.toLowerCase());
                localStorage.setItem('quizAttempts', JSON.stringify(attempts));
            };

            const handleStartQuiz = () => {
                if (!studentInfo.firstName || !studentInfo.lastName || !studentInfo.email) {
                    setErrorMessage('All fields are required');
                    return;
                }

                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(studentInfo.email)) {
                    setErrorMessage('Please enter a valid email address');
                    return;
                }

                if (checkEmailExists(studentInfo.email)) {
                    setErrorMessage('This email has already been used to take the quiz. Only one attempt is allowed.');
                    return;
                }

                setErrorMessage('');
                recordAttempt(studentInfo.email);
                setStartTime(new Date());
                setStage('quiz');
            };

            const handleAnswerChange = (questionId, answer) => {
                setAnswers({ ...answers, [questionId]: answer });
            };

            const handleNext = () => {
                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                }
            };

            const handlePrevious = () => {
                if (currentQuestionIndex > 0) {
                    setCurrentQuestionIndex(currentQuestionIndex - 1);
                }
            };

            const calculateScore = () => {
                let mcqScore = 0;
                let mcqCount = 0;
                
                questions.forEach(q => {
                    if (q.options) {
                        mcqCount++;
                        const selectedOption = answers[q.id];
                        if (selectedOption && selectedOption.correct) {
                            mcqScore++;
                        }
                    }
                });
                
                return { mcqScore, totalMCQ: mcqCount };
            };

            const handleSubmit = () => {
                setEndTime(new Date());
                setStage('results');
                sendResultsEmail();
            };

            const sendResultsEmail = async () => {
                const { mcqScore, totalMCQ } = calculateScore();
                const timeTaken = formatTime(new Date() - startTime);

                const emailParams = {
                    to_email: 'tech.reknew@gmail.com',
                    student_name: `${studentInfo.firstName} ${studentInfo.lastName}`,
                    student_email: studentInfo.email,
                    mcq_score: `${mcqScore}/${totalMCQ}`,
                    time_taken: timeTaken,
                    submission_time: new Date().toLocaleString(),
                    detailed_results: generateDetailedResults()
                };

                try {
                    // Replace 'YOUR_SERVICE_ID' and 'YOUR_TEMPLATE_ID' with actual EmailJS credentials
                    await emailjs.send('service_rnxlcoo', 'template_eqen33i', emailParams);
                    console.log('Results sent successfully');
                } catch (error) {
                    console.error('Error sending email:', error);
                }
            };

            const generateDetailedResults = () => {
                let results = '';
                
                questions.forEach((q, index) => {
                    results += `\n${'='.repeat(80)}\n`;
                    results += `Q${index + 1}: ${q.question}\n`;
                    results += `${'='.repeat(80)}\n\n`;
                    
                    if (q.options) {
                        // MCQ Question
                        const selected = answers[q.id];
                        const correctOption = q.options.find(opt => opt.correct);
                        const isCorrect = selected && selected.correct;
                        
                        if (isCorrect) {
                            results += `✓ CORRECT\n`;
                            results += `Your answer: ${selected.text}\n\n`;
                        } else {
                            results += `✗ INCORRECT\n`;
                            results += `Your answer: ${selected ? selected.text : 'Not answered'}\n`;
                            results += `Correct answer: ${correctOption.text}\n\n`;
                        }
                        
                        results += `Explanation: ${q.explanation}\n`;
                        
                    } else {
                        // Coding Question
                        const submittedCode = answers[q.id] || 'No code submitted';
                        
                        results += `Type: CODING QUESTION\n\n`;
                        results += `Description:\n${q.description}\n\n`;
                        results += `Student's Code:\n`;
                        results += `${'-'.repeat(40)}\n`;
                        results += `${submittedCode}\n`;
                        results += `${'-'.repeat(40)}\n\n`;
                        results += `Sample Solution:\n`;
                        results += `${'-'.repeat(40)}\n`;
                        results += `${q.sampleSolution}\n`;
                        results += `${'-'.repeat(40)}\n\n`;
                        results += `Expected Output:\n${q.expectedOutput}\n`;
                    }
                });
                
                return results;
            };

            const formatTime = (milliseconds) => {
                const totalSeconds = Math.floor(milliseconds / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                return `${minutes} minutes ${seconds} seconds`;
            };

            if (stage === 'welcome') {
                return <WelcomeScreen 
                    studentInfo={studentInfo}
                    setStudentInfo={setStudentInfo}
                    onStart={handleStartQuiz}
                    errorMessage={errorMessage}
                />;
            }

            if (stage === 'quiz') {
                const currentQuestion = questions[currentQuestionIndex];
                const progress = ((currentQuestionIndex + 1) / questions.length) * 100;

                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-xl p-8 fade-in">
                                <div className="mb-6">
                                    <div className="flex justify-between items-center mb-2">
                                        <h2 className="text-2xl font-bold text-gray-800">
                                            Question {currentQuestionIndex + 1} of {questions.length}
                                        </h2>
                                        <Timer startTime={startTime} />
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                        <div 
                                            className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                            style={{ width: `${progress}%` }}
                                        />
                                    </div>
                                </div>

                                {currentQuestion.options ? (
                                    <MCQQuestion 
                                        question={currentQuestion}
                                        selectedAnswer={answers[currentQuestion.id]}
                                        onAnswerChange={(answer) => handleAnswerChange(currentQuestion.id, answer)}
                                    />
                                ) : (
                                    <CodingQuestion 
                                        question={currentQuestion}
                                        answer={answers[currentQuestion.id] || ''}
                                        onAnswerChange={(answer) => handleAnswerChange(currentQuestion.id, answer)}
                                    />
                                )}

                                <div className="flex justify-between mt-8">
                                    <button
                                        onClick={handlePrevious}
                                        disabled={currentQuestionIndex === 0}
                                        className="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        Previous
                                    </button>
                                    
                                    {currentQuestionIndex === questions.length - 1 ? (
                                        <button
                                            onClick={handleSubmit}
                                            className="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                        >
                                            Submit Quiz
                                        </button>
                                    ) : (
                                        <button
                                            onClick={handleNext}
                                            className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                        >
                                            Next
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (stage === 'results') {
                return <ResultsScreen 
                    studentInfo={studentInfo}
                    questions={questions}
                    answers={answers}
                    startTime={startTime}
                    endTime={endTime}
                />;
            }
        }

        function WelcomeScreen({ studentInfo, setStudentInfo, onStart, errorMessage }) {
            return (
                <div className="min-h-screen flex items-center justify-center px-4">
                    <div className="bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full fade-in">
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-bold text-gray-800 mb-2">Python Assessment Quiz</h1>
                            <p className="text-gray-600">ReKnew Training Program</p>
                        </div>

                        <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                            <h3 className="font-bold text-blue-800 mb-2">Quiz Instructions:</h3>
                            <ul className="text-sm text-blue-700 space-y-1">
                                <li>• Total Questions: 20 (14 MCQs + 6 Coding)</li>
                                <li>• Questions are randomly selected from a bank of 40</li>
                                <li>• One attempt only per email address</li>
                                <li>• Your time will be tracked</li>
                                <li>• You can navigate between questions</li>
                                <li>• Results will be shown at the end</li>
                                <li>• Results will be automatically emailed to ReKnew</li>
                            </ul>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="block text-gray-700 font-medium mb-2">First Name *</label>
                                <input
                                    type="text"
                                    value={studentInfo.firstName}
                                    onChange={(e) => setStudentInfo({...studentInfo, firstName: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Enter your first name"
                                />
                            </div>

                            <div>
                                <label className="block text-gray-700 font-medium mb-2">Last Name *</label>
                                <input
                                    type="text"
                                    value={studentInfo.lastName}
                                    onChange={(e) => setStudentInfo({...studentInfo, lastName: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Enter your last name"
                                />
                            </div>

                            <div>
                                <label className="block text-gray-700 font-medium mb-2">Email Address *</label>
                                <input
                                    type="email"
                                    value={studentInfo.email}
                                    onChange={(e) => setStudentInfo({...studentInfo, email: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="your.email@example.com"
                                />
                            </div>

                            {errorMessage && (
                                <div className="bg-red-50 border-l-4 border-red-500 p-4 text-red-700">
                                    {errorMessage}
                                </div>
                            )}

                            <button
                                onClick={onStart}
                                className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg"
                            >
                                Start Quiz
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function Timer({ startTime }) {
            const [elapsed, setElapsed] = useState(0);

            useEffect(() => {
                const interval = setInterval(() => {
                    setElapsed(new Date() - startTime);
                }, 1000);
                return () => clearInterval(interval);
            }, [startTime]);

            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);

            return (
                <div className="text-gray-600 font-mono">
                    Time: {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}
                </div>
            );
        }

        function MCQQuestion({ question, selectedAnswer, onAnswerChange }) {
            return (
                <div className="fade-in">
                    <h3 className="text-xl font-semibold text-gray-800 mb-6 whitespace-pre-wrap">
                        {question.question}
                    </h3>

                    <div className="space-y-3">
                        {question.options.map((option, index) => (
                            <label
                                key={index}
                                className={`block p-4 border-2 rounded-lg cursor-pointer transition-all ${
                                    selectedAnswer === option
                                        ? 'border-blue-500 bg-blue-50'
                                        : 'border-gray-200 hover:border-blue-300'
                                }`}
                            >
                                <input
                                    type="radio"
                                    name={`question-${question.id}`}
                                    checked={selectedAnswer === option}
                                    onChange={() => onAnswerChange(option)}
                                    className="mr-3"
                                />
                                <span className="text-gray-800">{option.text}</span>
                            </label>
                        ))}
                    </div>
                </div>
            );
        }

        function CodingQuestion({ question, answer, onAnswerChange }) {
            return (
                <div className="fade-in">
                    <h3 className="text-xl font-semibold text-gray-800 mb-4">
                        {question.question}
                    </h3>

                    <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
                        <p className="text-gray-700 whitespace-pre-wrap">{question.description}</p>
                    </div>

                    <div className="mb-4">
                        <h4 className="font-medium text-gray-700 mb-2">Expected Output:</h4>
                        <pre className="text-sm">{question.expectedOutput}</pre>
                    </div>

                    <div>
                        <label className="block font-medium text-gray-700 mb-2">Your Code:</label>
                        <textarea
                            value={answer}
                            onChange={(e) => onAnswerChange(e.target.value)}
                            className="w-full h-64 px-4 py-3 border border-gray-300 rounded-lg code-input focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Write your Python code here..."
                            spellCheck="false"
                        />
                    </div>
                </div>
            );
        }

        function ResultsScreen({ studentInfo, questions, answers, startTime, endTime }) {
            const mcqQuestions = questions.filter(q => q.options);
            const codingQuestions = questions.filter(q => !q.options);

            let mcqScore = 0;
            mcqQuestions.forEach(q => {
                const selected = answers[q.id];
                if (selected && selected.correct) mcqScore++;
            });

            const timeTaken = Math.floor((endTime - startTime) / 1000);
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;

            return (
                <div className="min-h-screen py-8 px-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-xl p-8 fade-in">
                            <div className="text-center mb-8">
                                <h1 className="text-4xl font-bold text-gray-800 mb-2">Quiz Complete!</h1>
                                <p className="text-gray-600">
                                    {studentInfo.firstName} {studentInfo.lastName}
                                </p>
                            </div>

                            <div className="grid md:grid-cols-3 gap-4 mb-8">
                                <div className="bg-blue-50 rounded-lg p-6 text-center">
                                    <div className="text-3xl font-bold text-blue-600">{mcqScore}/{mcqQuestions.length}</div>
                                    <div className="text-gray-600 mt-2">MCQ Score</div>
                                </div>
                                <div className="bg-green-50 rounded-lg p-6 text-center">
                                    <div className="text-3xl font-bold text-green-600">{codingQuestions.length}</div>
                                    <div className="text-gray-600 mt-2">Coding Questions</div>
                                </div>
                                <div className="bg-purple-50 rounded-lg p-6 text-center">
                                    <div className="text-3xl font-bold text-purple-600">{minutes}:{String(seconds).padStart(2, '0')}</div>
                                    <div className="text-gray-600 mt-2">Time Taken</div>
                                </div>
                            </div>

                            <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-8">
                                <p className="text-yellow-800">
                                    ✓ Your results have been automatically sent to tech.reknew@gmail.com
                                </p>
                                <p className="text-yellow-700 text-sm mt-1">
                                    Coding questions will be manually reviewed by instructors.
                                </p>
                            </div>

                            <div className="mt-8 text-center">
                                <p className="text-gray-600">
                                    Thank you for completing the Python Assessment Quiz!
                                </p>
                                <p className="text-sm text-gray-500 mt-2">
                                    Your instructors will review your submissions and provide feedback.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<QuizApp />, document.getElementById('root'));
    </script>
</body>
</html>
